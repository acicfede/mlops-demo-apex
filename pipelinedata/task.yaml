apiVersion: tekton.dev/v1
kind: Task
metadata:
  name: run-kfp-yaml
spec:
  params:
    - name: pipeline-yaml-url
      type: string
    - name: pipeline-name
      type: string
    - name: kfp-endpoint
      type: string
  steps:
    - name: run-pipeline
      image: python:3.11-slim
      env:
        - name: KFP_ENDPOINT
          value: "$(params.kfp-endpoint)"
      script: |
        echo "ğŸ”§ Installo KFP CLI..."
        pip install kfp --no-cache-dir

        echo "â¬‡ï¸ Scarico il file pipeline..."
        curl -L "$(params.pipeline-yaml-url)" -o pipeline.yaml

        echo "ğŸŒ Imposto endpoint DSPA/KFP..."
        kfp client set-host "$KFP_ENDPOINT"

        echo "ğŸš€ Upload pipeline..."
        kfp pipeline upload -f pipeline.yaml -n "$(params.pipeline-name)"
